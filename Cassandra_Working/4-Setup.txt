--GKE Autopilot

Create an Autopilot cluster by specifying a name and region. After the cluster is created, you can deploy your workload through Kubernetes 
and we’ll take care of the rest, including:

  Nodes: Automated node provisioning, scaling, and maintenance
  Networking: VPC-native traffic routing for clusters
  Security: Shielded GKE Nodes and Workload Identity
  Telemetry: Cloud Operations logging and monitoring

Name: autopilot-cluster-1
Region: us-central1

Fleet registration

A fleet lets you logically group and normalize Kubernetes clusters, helping you uplevel management from individual clusters to groups of clusters. 
To use multi-cluster capabilities and apply consistent policies across your systems, register your cluster to a fleet.

Your cluster will be hosted in project ‘cryptic-tower-477608-g6’. To register it to a fleet in another project, skip this step and use the CLI.

Networking
Control Plane Access
Define from where you can access the control plane.

Accessing using DNS
DNS-based control plane access is recommended. For a simple, secure, and scalable way to access the control plane, configure IAM-based policies or token-based authentication.

<Default>
Access using IPv4 addresses
Enable authorized networks<not enabled>
To safeguard your operations and your data, add at least one authorized network. This restricts access to your cluster's control plane using an IP-based firewall.

Firewall rules
Access using the control plane's external IP address

<not selected>
Access using the control plane's internal IP address from any region
Enforce authorized networks on the control plane's internal endpoint
Add Google Cloud external IP addresses to authorized networks

Cluster networking
Define how applications in this cluster communicate with each other and how clients can reach them.
Network: default
Node subnet: default
<not selected> Enable private nodes

Advanced networking options
Override control plane’s default private endpoint subnet: <not selected> 
--Cluster default POD address range (/17)
[All pods in the cluster are assigned an IP address from this range. Enter a range (in CIDR notation) within a network range, a mask, or leave this field blank to use a default range.
This setting is permanent]

Service address range
[Cluster services will be assigned an IP address from this IP address range. Enter a range (in CIDR notation) within a network range, a mask, or leave this field blank to use a default range.
This setting is permanent]
Enable Observability (Dataplane V2)
Additive VPC scope DNS
Disable VPC firewall rule auto-creation for LoadBalancer Services

<create>
-----------------------------------
ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ gcloud container clusters get-credentials autopilot-cluster-1 --region us-central1
Fetching cluster endpoint and auth data.
kubeconfig entry generated for autopilot-cluster-1.

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ kubectl config current-context
gke_cryptic-tower-477608-g6_us-central1_autopilot-cluster-1

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ kubectl config get-contexts
CURRENT   NAME                                                          CLUSTER                                                       AUTHINFO                                                      NAMESPACE
*         gke_cryptic-tower-477608-g6_us-central1_autopilot-cluster-1   gke_cryptic-tower-477608-g6_us-central1_autopilot-cluster-1   gke_cryptic-tower-477608-g6_us-central1_autopilot-cluster-1

kubectl get pods -A
NAMESPACE         NAME                                                      READY   STATUS    RESTARTS   AGE
gke-gmp-system    alertmanager-0                                            0/2     Pending   0          61m
gke-gmp-system    gmp-operator-6f97f894f6-n84pc                             0/1     Pending   0          61m
gke-gmp-system    rule-evaluator-76b79f68fc-wp7w6                           0/2     Pending   0          61m
gke-managed-cim   kube-state-metrics-0                                      0/2     Pending   0          61m
kube-system       antrea-controller-horizontal-autoscaler-7c9f9c4c7-fpwfp   0/1     Pending   0          61m
kube-system       egress-nat-controller-77587699f-96t7s                     0/1     Pending   0          61m
kube-system       event-exporter-gke-6f557b5454-pq9z6                       0/2     Pending   0          61m
kube-system       filestore-lock-release-controller-79fdbd95d5-frcl4        0/2     Pending   0          61m
kube-system       konnectivity-agent-5d7fc9d976-52ltd                       0/2     Pending   0          61m
kube-system       konnectivity-agent-autoscaler-6d9956645f-9kksw            0/1     Pending   0          61m
kube-system       kube-dns-6477fbb69-8mdbk                                  0/4     Pending   0          61m
kube-system       kube-dns-autoscaler-5bf7f79bb4-tgw5k                      0/1     Pending   0          61m
kube-system       l7-default-backend-78858cccc9-z7pt6                       0/1     Pending   0          61m
kube-system       metrics-server-v1.33.0-64b8bdcfb4-28kz7                   0/1     Pending   0          61m
kube-system       metrics-server-v1.33.0-6b8795c6f6-q5lnh                   0/1     Pending   0          61m

gcloud container clusters describe autopilot-cluster-1 --region us-central1

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ gcloud container node-pools list --cluster autopilot-cluster-1 --region us-central1
ERROR: (gcloud.container.node-pools.list) ResponseError: code=400, message=Autopilot node pools cannot be accessed or modified.

kubectl run echo --image=busybox --command -- sleep 3600
Warning: autopilot-default-resources-mutator:Autopilot updated Pod default/echo: defaulted unspecified 'cpu' resource for containers [echo] (see http://g.co/gke/autopilot-defaults).
pod/echo created

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ kubectl get pods
NAME   READY   STATUS    RESTARTS   AGE
echo   0/1     Pending   0          25s

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ kubectl get pods -A
NAMESPACE         NAME                                                      READY   STATUS    RESTARTS   AGE
default           echo                                                      0/1     Pending   0          32s
gke-gmp-system    alertmanager-0                                            0/2     Pending   0          67m
gke-gmp-system    gmp-operator-6f97f894f6-n84pc                             0/1     Pending   0          67m
gke-gmp-system    rule-evaluator-76b79f68fc-wp7w6                           0/2     Pending   0          67m
gke-managed-cim   kube-state-metrics-0                                      0/2     Pending   0          68m
kube-system       antrea-controller-horizontal-autoscaler-7c9f9c4c7-fpwfp   0/1     Pending   0          67m
kube-system       egress-nat-controller-77587699f-96t7s                     0/1     Pending   0          67m
kube-system       event-exporter-gke-6f557b5454-pq9z6                       0/2     Pending   0          68m
kube-system       filestore-lock-release-controller-79fdbd95d5-frcl4        0/2     Pending   0          68m
kube-system       konnectivity-agent-5d7fc9d976-52ltd                       0/2     Pending   0          68m
kube-system       konnectivity-agent-autoscaler-6d9956645f-9kksw            0/1     Pending   0          68m
kube-system       kube-dns-6477fbb69-8mdbk                                  0/4     Pending   0          68m
kube-system       kube-dns-autoscaler-5bf7f79bb4-tgw5k                      0/1     Pending   0          68m
kube-system       l7-default-backend-78858cccc9-z7pt6                       0/1     Pending   0          68m
kube-system       metrics-server-v1.33.0-64b8bdcfb4-28kz7                   0/1     Pending   0          67m
kube-system       metrics-server-v1.33.0-6b8795c6f6-q5lnh                   0/1     Pending   0          67m

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ kubectl get ingress -A
No resources found

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ kubectl get svc -A
NAMESPACE        NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)            AGE
default          kubernetes             ClusterIP   34.118.224.1     <none>        443/TCP            72m
gke-gmp-system   alertmanager           ClusterIP   None             <none>        9093/TCP           69m
gke-gmp-system   gmp-operator           ClusterIP   34.118.237.229   <none>        8443/TCP,443/TCP   69m
gke-gmp-system   rule-evaluator         ClusterIP   34.118.225.210   <none>        19092/TCP          69m
kube-system      antrea                 ClusterIP   34.118.228.138   <none>        443/TCP            68m
kube-system      default-http-backend   NodePort    34.118.228.37    <none>        80:30815/TCP       69m
kube-system      kube-dns               ClusterIP   34.118.224.10    <none>        53/UDP,53/TCP      70m
kube-system      metrics-server         ClusterIP   34.118.235.251   <none>        443/TCP            69

ak7singhal@cloudshell:~ (cryptic-tower-477608-g6)$ kubectl get storageclass
NAME                        PROVISIONER                        RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
enterprise-multishare-rwx   filestore.csi.storage.gke.io       Delete          WaitForFirstConsumer   true                   70m
enterprise-rwx              filestore.csi.storage.gke.io       Delete          WaitForFirstConsumer   true                   70m
parallelstore-rwx           parallelstore.csi.storage.gke.io   Delete          WaitForFirstConsumer   false                  69m
premium-rwo                 pd.csi.storage.gke.io              Delete          WaitForFirstConsumer   true                   69m
premium-rwx                 filestore.csi.storage.gke.io       Delete          WaitForFirstConsumer   true                   70m
regional-rwx                filestore.csi.storage.gke.io       Delete          WaitForFirstConsumer   true                   70m
standard                    kubernetes.io/gce-pd               Delete          Immediate              true                   69m
standard-rwo (default)      pd.csi.storage.gke.io              Delete          WaitForFirstConsumer   true                   69m
standard-rwo-regional       pd.csi.storage.gke.io              Delete          WaitForFirstConsumer   true                   70m
standard-rwx                filestore.csi.storage.gke.io       Delete          WaitForFirstConsumer   true                   70m
zonal-rwx                   filestore.csi.storage.gke.io       Delete          WaitForFirstConsumer   true                   70m


gcloud container node-pools create default-pool \
  --cluster autopilot-cluster-1 \
  --region us-central1 \
  --machine-type e2-standard-4 \
  --num-nodes 3





